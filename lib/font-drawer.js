const lowercase = `
  ..... 0.... ..... ....0 ..... ...00 ..... 0.... ..0.. ..0.. .0... ..0.. ..... ..... ..... ..... ..... ..... ..... ..0.. ..... ..... ..... ..... ..... .....
  ..... 0.... ..... ....0 ..... ..0.. ..... 0.... ..... ..... .0... ..0.. ..... ..... ..... ..... ..... ..... ..... ..0.. ..... ..... ..... ..... ..... .....
  .000. 000.. .0000 .0000 .000. .0000 .0000 0000. ..0.. ..0.. .0..0 ..0.. 00.0. 0000. .000. 0000. .0000 0.00. .0000 .0000 0...0 0...0 0...0 0...0 0...0 00000
  ....0 0...0 0.... 0...0 0...0 ..0.. 0...0 0...0 ..0.. ..0.. .0.0. ..0.. 0.0.0 0...0 0...0 0...0 0...0 00..0 0.... ..0.. 0...0 0...0 0...0 .0.0. 0...0 ...0.
  .0000 0...0 0.... 0...0 00000 ..0.. 0...0 0...0 ..0.. ..0.. .00.. ..0.. 0.0.0 0...0 0...0 0...0 0...0 0.... .000. ..0.. 0...0 .0.0. 0.0.0 ..0.. 0...0 ..0..
  0...0 0...0 0.... 0...0 0.... ..0.. .0000 0...0 ..0.. ..0.. .0.0. ..0.. 0...0 0...0 0...0 0...0 0...0 0.... ....0 ..0.. 0..00 .0.0. 0.0.0 .0.0. .0000 .0...
  .0000 0000. .0000 .0000 .000. ..0.. ....0 0...0 ..0.. ..0.. .0..0 ...00 0...0 0...0 .000. 0000. .0000 0.... 0000. ...00 .00.0 ..0.. .0.0. 0...0 ...0. 00000
  ..... ..... ..... ..... ..... ..... .000. ..... ..... 00... ..... ..... ..... ..... ..... 0.... ....0 ..... ..... ..... ..... ..... ..... ..... .00.. .....
    a     b     c     d     e     f     g     h     i     j     k     l     m     n     o     p     q     r     s     t     u     v     w     x     y     z  
`;
const uppercase = `
  ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... 
  ..0.. 0000. .000. 0000. 00000 00000 .0000 0...0 .000. ...0. .0..0 .0... 0...0 0...0 .000. 0000. .000. 0000. .0000 00000 0...0 0...0 0...0 0...0 0...0 00000 
  .0.0. 0...0 0...0 0...0 0.... 0.... 0.... 0...0 ..0.. ...0. .0.0. .0... 00.00 00..0 0...0 0...0 0...0 0...0 0.... ..0.. 0...0 0...0 0...0 .0.0. 0...0 ....0 
  .0.0. 0000. 0.... 0...0 0000. 0.... 0.000 0...0 ..0.. ...0. .00.. .0... 0.0.0 0.0.0 0...0 0...0 0...0 0...0 .000. ..0.. 0...0 0...0 0...0 ..0.. .0.0. ..00. 
  0...0 0...0 0.... 0...0 0.... 0000. 0...0 00000 ..0.. ...0. .0.0. .0... 0...0 0..00 0...0 0000. 0...0 0000. ....0 ..0.. 0...0 .0.0. 0.0.0 .0.0. ..0.. .0... 
  00000 0...0 0...0 0...0 0.... 0.... 0..00 0...0 ..0.. 0..0. .0..0 .0... 0...0 0...0 0...0 0.... 0..0. 0...0 0...0 ..0.. 0...0 .0.0. 00.00 0...0 ..0.. 0.... 
  0...0 0000. .000. 0000. 00000 0.... .00.0 0...0 .000. .00.. .0..0 .0000 0...0 0...0 .000. 0.... .00.0 0...0 .000. ..0.. .000. ..0.. 0...0 0...0 ..0.. 00000 
  ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... 
    A     B     C     D     E     F     G     H     I     J     K     L     M     N     O     P     Q     R     S     T     U     V     W     X     Y     Z  
`;
const digits = `
  ..... ..... ..... ..... ..... ..... ..... ..... ..... .....
  .000. ..0.. .000. 0000. ...00 00000 ..000 00000 .000. .000.
  0..00 .00.. 0...0 ....0 ..0.0 0.... .0... ....0 0...0 0...0
  0.0.0 ..0.. ...0. .000. .0..0 .000. 0000. ...0. .000. 0...0
  00..0 ..0.. ..0.. ....0 0...0 ....0 0...0 ..0.. 0...0 .0000
  0...0 ..0.. .0... 0...0 00000 0...0 0...0 ..0.. 0...0 ...0.
  .000. .000. 00000 .000. ....0 .000. .000. ..0.. .000. .00..
  ..... ..... ..... ..... ..... ..... ..... ..... ..... .....
    0     1     2     3     4     5     6     7     8     9  
`;
const specialCharacters = `
  ..... ..... ..... ..... .00.. ..... ..... ..... ..... ..... ....0 0.... ..000 000.. ..... ..... ..0.. ..... ..... ..... ..... ..... ..... ..... ..... .....
  ..... ..... ..... ..... .00.. .000. ..... ..... ..... ..... ...0. .0... ..0.. ..0.. ..... ..... ..0.. ...0. .0... ..... ..0.. .00.. ..00. ..0.. .00.. 000..
  ..... ..... .00.. .00.. .00.. 00.00 ..... ..... ..0.. 0.0.0 ..0.. ..0.. ..0.. ..0.. ...00 00... ..0.. ...0. .0... ..... .000. 0..0. .0..0 .0.0. 0..0. 0.0.0
  ..... ..... .00.. .00.. .0... ...00 ..... ..... ..0.. .000. ..0.. ..0.. ..0.. ..0.. .00.. ..00. ..0.. ..0.. ..0.. .0000 0.... .00.. 0.000 0...0 0..0. 0000.
  ..... ..... ..... ..... .0... ..00. .000. 00000 00000 00.00 ..0.. ..0.. ..0.. ..0.. 0.... ....0 ..0.. ..0.. ..0.. ..... .000. 0.0.0 0.0.0 ..... .00.. ..0..
  .00.. .00.. .00.. .00.. ..... ..... ..... ..... ..0.. .000. ...0. .0... ..0.. ..0.. .00.. ..00. ..0.. .0... ...0. .0000 ....0 0..0. 0.000 ..... ..... .0000
  .00.. ..0.. .00.. ..0.. .0... ..0.. ..... ..... ..0.. 0.0.0 ....0 0.... ..000 000.. ...00 00... ..0.. .0... ...0. ..... .000. .00.0 .0... ..... ..... 0.0.0
  ..... .0... ..... .0... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..0.. ..... ..000 ..... ..... ..000
    .     ,     :     ;     !     ?     -     –     +     *     (     )     [     ]     <     >     |     /     \     =     $     &     @     ^     °     %
`;
const unknownCharacter = `
  .000.
  00000
  0.0.0
  00.00
  0.0.0
  00000
  .000.
  .....
   null
`;

function parseGlyphs(ascii) {
  const AllLines = ascii.split('\n');
  const lines = AllLines.filter(line => line.length > 0);
  const labelLine = lines.pop();
  const height = lines.length;
  
  const firstLine = lines[0];
  const glyphPositions = [];
  const regex = /\S+/g; // IMPORTANT! This creates a regex object and keeps state in while loop.
  let match;
  while ((match = regex.exec(firstLine)) !== null) {
    glyphPositions.push({
      text: match[0],
      start: match.index,
      end: match.index + match[0].length, // End index is excluded [start, end[
    });
  }

  const glyphs = [];
  for (const glyphPosition of glyphPositions) {
    const glyphBits = [];
    const { start, end } = glyphPosition;
    for (let j = 0; j < lines.length; j++) {
      for (let i = start; i < end; i++) {
        const char = lines[j][i];
        glyphBits.push(char === "." ? 0 : 1);
      }
    }
    const width = end - start;
    const label = labelLine.substring(start, end).trim();
    glyphs.push({ id: label, w: width, h: height, bits: glyphBits });
  }
  
  return glyphs;
}

export function getFont() {
  const glyphs = [
    ...parseGlyphs(lowercase),
    ...parseGlyphs(uppercase),
    ...parseGlyphs(digits),
    ...parseGlyphs(specialCharacters),
    ...parseGlyphs(unknownCharacter),
  ];
  const font = {};
  for (const glyph of glyphs) {
    const { id, w, h, bits} = glyph;
    font[id] = { w, h , bits};
  }
  return font;
}
